---
title: "Build a Text-to-Speech App with Per-Character Billing"
description: "Build a production-ready TTS app with ElevenLabs and Dodo Payments, complete with a free tier, credit packs, and checkout."
---

# Chirpify AI: Text-to-Speech with Per-Character Billing

By the end of this cookbook, you'll have a fully deployed text-to-speech app that lets users type text, pick a voice, generate speech, and pay for it, with a freemium model, three credit tiers, and a real checkout flow.

<video src="/videos/Astute_Platinum_Saga-1.mp4" controls={true} />

<Card icon="github" href="https://github.com/aainanarang29/chirpify-ai" title="Full Source Code">
  Skip the tutorial. Clone, configure, deploy. Every file referenced below lives here.
</Card>

---

## What You'll Build

- **ElevenLabs TTS** with 5 voice options: type text, hear it spoken back
- **Freemium model** with 500 free characters on first visit, no signup needed
- **Three credit packs**: Starter (10K), Pro (50K), Power (200K) characters
- **Dodo Payments checkout** with real payment links, receipts, and test mode for dev
- **Live credit tracking** with real-time balance updates and color-coded warnings when running low
- **One-command deploy** with `vercel --prod`

Total cost to build and host: **\$0**.

---

## Architecture

{/* ðŸŽ¨ EXCALIDRAW DIAGRAM #1: Architecture Overview */}

Three layers. Your **frontend** talks to **Vercel serverless functions** that do two things: call ElevenLabs for audio generation and call Dodo for payment sessions. Credits live in `localStorage`, which keeps things simple with no database needed for the demo.

<Accordion title="Full tech stack">
  | Layer    | Technology                     | Why                                                                     |
  | -------- | ------------------------------ | ----------------------------------------------------------------------- |
  | Frontend | HTML5, CSS3, vanilla JS        | No framework overhead. Loads fast.                                      |
  | Backend  | Node.js 18+, Vercel Serverless | Two API routes total.                                                   |
  | TTS      | ElevenLabs API                 | High-quality voices. Free tier includes 10K chars/month.                |
  | Payments | Dodo Payments                  | One API call to create a payment link. Handles tax, receipts, and more. |
  | Hosting  | Vercel                         | Push to GitHub and it's live. SSL included.                             |
  | State    | localStorage                   | Works well for a demo. Swap for a DB when you're ready to scale.        |
</Accordion>

---

## Pricing Model

Chirpify uses the same model as ElevenLabs, Resend, and most usage-based SaaS: buy credits upfront, spend them as you go.

| Pack       | Characters | Price | Per 1K chars | Who it's for      |
| ---------- | ---------- | ----- | ------------ | ----------------- |
| ðŸŸ¢ Starter | 10,000     | \$5   | \$0.50       | Kicking the tires |
| ðŸ”µ Pro     | 50,000     | \$10  | \$0.20       | Regular use       |
| ðŸŸ£ Power   | 200,000    | \$25  | \$0.125      | Volume users      |

The more you buy, the cheaper it gets. A straightforward volume discount where users self-select into the tier that matches their usage.

---

## Step 1: Set Up Products in Dodo

Before writing any code, you need three products in Dodo, one for each credit pack. There are two ways to do this.

### Option A: The Dashboard (2 minutes, no code)

{/* ðŸŽ¥ VIDEO #1: "How to Add API Key in Dodo"
<Frame caption="Getting your Dodo API key">
 <video controls src="/videos/dodo-api-key-setup.mp4" />
</Frame>
*/}

{/* ðŸŽ¥ VIDEO #2: "How to Add Products in Dodo"
<Frame caption="Creating your credit pack products">
 <video controls src="/videos/dodo-create-products.mp4" />
</Frame>
*/}

<Steps>
  <Step title="Grab your API key">
    Head to your [Dodo Payments Dashboard](https://dashboard.dodopayments.com), go to **API Keys**, and generate a new key. Save it somewhere safe. You'll need it in Step 2.
  </Step>
  <Step title="Create the Starter Pack">
    **Products â†’ Create Product**. Name it "Starter Pack", set the price to \$5.00 USD, type to one-time payment, tax category to Digital Products. Hit **Create**, copy the `product_id`. Done.

    <video src="/videos/Happy_Pewter_Condor.mp4" controls={true} />
  </Step>
  <Step title="Repeat for Pro and Power">
    Same flow. Pro Pack = $10 (50K characters). Power Pack = $25 (200K characters). Save all three `product_id` values. You'll plug them into your checkout API next.
  </Step>
</Steps>

### Option B: cURL it

If clicking buttons isn't your thing:

```bash
curl -X POST "https://test.dodopayments.com/products" \
  -H "Authorization: Bearer YOUR_DODO_API_KEY" \
  -H "Content-Type: application/json" \
  -d '{
    "name": "Starter Pack",
    "description": "10,000 characters for text-to-speech",
    "price": {
      "currency": "USD",
      "price": 500,
      "type": "one_time_price"
    },
    "tax_category": "digital_products"
  }'
```

<Card icon="github" href="https://github.com/aainanarang29/chirpify-ai#create-products" title="All three cURL commands">
  Starter, Pro, and Power pack creation. Copy, paste, run.
</Card>

<Info>
  `test.dodopayments.com` for development. `live.dodopayments.com` when you're ready for real money.
</Info>

---

## Step 2: Build the Checkout API

When a user clicks "Buy", your API creates a Dodo payment, the user gets redirected to a hosted checkout page, pays, and lands back on your app with credits added. One serverless function handles the entire flow.

{/* ðŸŽ¨ EXCALIDRAW DIAGRAM #2: Payment Flow */}

<video src="/videos/Earnest_Chimera.mp4" controls={true} />

Here's the core of `api/checkout.js`, the part that talks to Dodo:

```javascript api/checkout.js
const PRODUCTS = {
  starter: { id: 'pdt_YOUR_STARTER_ID', characters: 10000 },
  pro:     { id: 'pdt_YOUR_PRO_ID',     characters: 50000 },
  power:   { id: 'pdt_YOUR_POWER_ID',   characters: 200000 },
};

// One API call creates the payment link
const response = await fetch(`${DODO_BASE_URL}/payments`, {
  method: 'POST',
  headers: {
    'Authorization': `Bearer ${DODO_API_KEY}`,
    'Content-Type': 'application/json',
  },
  body: JSON.stringify({
    payment_link: true, // Required. Without this, payment_link returns null.
    billing: { city: 'San Francisco', country: 'US', state: 'CA', street: '123 Main St', zipcode: '94102' },
    customer: { email: 'customer@example.com', name: 'Customer' },
    product_cart: [{ product_id: product.id, quantity: 1 }],
    return_url: `${returnUrl}?success=true&characters=${product.characters}`,
  }),
});
```

<Card icon="github" href="https://github.com/aainanarang29/chirpify-ai/blob/main/api/checkout.js" title="Full checkout handler">
  Includes error handling, env switching, and response parsing.
</Card>

<Warning>
  **`Always include payment_link: true.`** Without it, `payment_link` comes back `null` and the checkout button won't work. This is the most common integration issue.
</Warning>

---

## Step 3: Handle Payment Success

After checkout, Dodo redirects users back to your `return_url` with the query params you included. Your frontend parses them and tops up the balance. No webhooks needed for the demo.

```javascript
const urlParams = new URLSearchParams(window.location.search);

if (urlParams.get('success') === 'true') {
  const addedChars = parseInt(urlParams.get('characters') || '0');
  if (addedChars > 0) {
    let credits = parseInt(localStorage.getItem('chirpify_credits') || '500');
    credits += addedChars;
    localStorage.setItem('chirpify_credits', credits.toString());
    window.history.replaceState({}, '', window.location.pathname); // Clean URL
    showToast(`${addedChars.toLocaleString()} characters added!`);
  }
}
```

<Note>
  For production, don't rely on URL params alone. Set up [Dodo webhooks](https://docs.dodopayments.com) for server-side payment verification. URL params work for demos but aren't secure enough for real transactions.
</Note>

---

## Step 4: Track Usage and Deduct Credits

The rule is simple: check balance first, call the API, deduct only on success. Never charge for a failed generation.

{/* ðŸŽ¨ EXCALIDRAW DIAGRAM #3: Credit Deduction Flow */}

```javascript
async function generateSpeech(text, voice) {
  const charCost = text.length;
  let credits = parseInt(localStorage.getItem('chirpify_credits') || '500');

  // No credits? Show the upsell.
  if (credits < charCost) {
    showPricingModal();
    return;
  }

  const response = await fetch('/api/speak', {
    method: 'POST',
    headers: { 'Content-Type': 'application/json' },
    body: JSON.stringify({ text, voice }),
  });

  if (!response.ok) throw new Error('Speech generation failed');

  // Only deduct after a successful generation
  credits -= charCost;
  localStorage.setItem('chirpify_credits', credits.toString());
  updateCreditsDisplay();

  const data = await response.json();
  playAudio(data.audio);
}
```

<Card icon="github" href="https://github.com/aainanarang29/chirpify-ai/blob/main/public/app.js" title="Complete usage tracking">
  Full implementation with error handling, loading spinners, and edge cases.
</Card>

---

## Step 5: Build the Pricing UI

When credits run out, show a clean upgrade modal. Three cards, three price points, one click to checkout.

Each card carries a `data-pack` attribute that maps to your product config. Click fires `/api/checkout`, response comes back with a Dodo checkout URL, `window.location.href` does the rest. No modals-within-modals, no multi-step forms. Click, pay, done.

<Card icon="github" href="https://github.com/aainanarang29/chirpify-ai/blob/main/public/index.html" title="Pricing modal markup + handlers">
  HTML structure, click handlers, and loading states. Ready to drop into your project.
</Card>

---

## Step 6: Display Credit Balance

A live counter in the header that tells users exactly where they stand. Green when healthy, yellow when running low, red when empty. No ambiguity.

```javascript
function updateCreditsDisplay() {
  const credits = parseInt(localStorage.getItem('chirpify_credits') || '500');
  const display = document.querySelector('.credits-number');

  display.textContent = credits >= 1000
    ? (credits / 1000).toFixed(credits % 1000 === 0 ? 0 : 1) + 'K'
    : credits.toString();

  container.classList.toggle('empty', credits <= 0);
  container.classList.toggle('low', credits > 0 && credits < 100);
}
```

Showing the balance gives users confidence in their spending and a clear signal when it's time to top up.

---

## Step 7: Wire Up ElevenLabs

The TTS endpoint is a thin wrapper around ElevenLabs. Text and voice go in, base64 audio comes out. Your frontend decodes it and plays it.

```javascript api/speak.js
const VOICES = {
  george: 'JBFqnCBsd6RMkjVDRZzb',
  aria: 'Xb7hH8MSUJpSbSDYk0k2',
  roger: 'CwhRBWXzGAHq8TQ4Fs17',
  sarah: 'EXAVITQu4vr4xnSDxMaL',
  charlie: 'IKne3meq5aSn9XLyUdCD',
};

const response = await fetch(
  `https://api.elevenlabs.io/v1/text-to-speech/${voiceId}`,
  {
    method: 'POST',
    headers: { 'xi-api-key': ELEVENLABS_API_KEY, 'Content-Type': 'application/json' },
    body: JSON.stringify({
      text,
      model_id: 'eleven_monolingual_v1',
      voice_settings: { stability: 0.5, similarity_boost: 0.75 },
    }),
  }
);

const audioBuffer = await response.arrayBuffer();
const base64Audio = Buffer.from(audioBuffer).toString('base64');
```

<Card icon="github" href="https://github.com/aainanarang29/chirpify-ai/blob/main/api/speak.js" title="Full ElevenLabs handler">
  Validation, error handling, and voice fallbacks. The complete `api/speak.js`.
</Card>

---

## Deploy It

### Environment Variables

Add these in Vercel under **Settings \> Environment Variables**:

| Variable                | What it does                        | Example                          |
| ----------------------- | ----------------------------------- | -------------------------------- |
| `DODO_PAYMENTS_API_KEY` | Authenticates with Dodo             | `sk_test_...`                    |
| `DODO_ENV`              | Switches test/live                  | `test`                           |
| `ELEVENLABS_API_KEY`    | Authenticates with ElevenLabs       | `xi_...`                         |
| `SITE_URL`              | Your app URL (for return redirects) | `https://chirpify-ai.vercel.app` |

### Deploy

```bash
npm install -g vercel
vercel --prod
```

Two commands and you're live.

<Accordion title="vercel.json (if you need it)">
  ```json vercel.json
  {
    "framework": null,
    "buildCommand": "",
    "installCommand": "npm install",
    "outputDirectory": "public"
  }
  ```
</Accordion>

---

## Test It

Dodo's test mode gives you a fake card that always succeeds:

| Field       | Value                 |
| ----------- | --------------------- |
| Card Number | `4242 4242 4242 4242` |
| Expiry      | Any future date       |
| CVC         | Any 3 digits          |
| ZIP         | Any 5 digits          |

**Full test flow:** Load the app, use your free 500 characters, run out, see the pricing modal, buy the Starter Pack with the test card, get redirected back, confirm 10K characters in your balance, generate more speech, refresh the page, and verify the balance persists.

If all of that works, you've got a working SaaS.

---

## Things That'll Save You Debugging Time

<CardGroup cols={2}>
  <Card icon="triangle-exclamation" title="payment_link: true">
    Forget this flag and your checkout URL comes back null. The single most common Dodo integration bug.
  </Card>
  <Card icon="database" title="localStorage is a demo tool">
    It works great here. In production, move credits to a database and validate server-side. Users can edit localStorage in DevTools.
  </Card>
  <Card icon="rotate-right" title="Return URL params">
    Passing credit count in the URL works for demos. For real apps, use webhooks so credits only add after confirmed payment.
  </Card>
  <Card icon="shield-check" title="Check credits before API calls">
    Never call ElevenLabs without checking balance first. Failed generations that still deduct credits = angry users.
  </Card>
</CardGroup>

---

## Going Live

<Warning>
  Everything in this cookbook runs on **test mode**. Flip these switches before taking real payments.
</Warning>

|           | Test                                                   | Live                                                             |
| --------- | ------------------------------------------------------ | ---------------------------------------------------------------- |
| Base URL  | `test.dodopayments.com`                                | `live.dodopayments.com`                                          |
| API Keys  | `sk_test_...`                                          | `sk_live_...`                                                    |
| Payments  | Simulated (no real charges)                            | Real money                                                       |
| Dashboard | [test.dodopayments.com](https://test.dodopayments.com) | [dashboard.dodopayments.com](https://dashboard.dodopayments.com) |

The switch: create live products in the dashboard, generate a live API key, update your Vercel env vars, swap the product IDs in `api/checkout.js`. Test with a real card (you can refund yourself), and you're in business.

---

## Keep Building

<CardGroup cols={3}>
  <Card icon="book" href="https://docs.dodopayments.com" title="Dodo Payments Docs">
    API reference, webhooks, SDKs
  </Card>
  <Card icon="microphone" href="https://docs.elevenlabs.io" title="ElevenLabs Docs">
    Voice models, streaming, cloning
  </Card>
  <Card icon="rocket" href="https://vercel.com/docs" title="Vercel Docs">
    Edge functions, domains, CI/CD
  </Card>
</CardGroup>