---
title: "Build a Text-to-Speech App with Per-Character Billing"
description: "Learn how to build Chirpify AI - a text-to-speech app using ElevenLabs and Dodo Payments for credit-based monetization"
---

# Chirpify AI: Text-to-Speech with Per-Character Billing

Build a modern text-to-speech web application that charges users per character using Dodo Payments. Users get 500 free characters to try, then purchase credit packs to continue generating speech.

<Frame>
  <img src="/images/chirpify-demo.png" alt="Chirpify AI Demo" />
</Frame>

<Info>
  **Before you start, make sure you have:**

  - A [Dodo Payments account](https://dashboard.dodopayments.com) (free to create)
  - An [ElevenLabs API key](https://elevenlabs.io) (free tier available)
  - Node.js 18+ installed locally
  - A [Vercel account](https://vercel.com) for deployment
  - Basic familiarity with JavaScript and REST APIs
</Info>

## What You'll Build

- A text-to-speech app powered by ElevenLabs
- Per-character billing with three pricing tiers
- Server-side credit tracking with Dodo Wallets
- Dodo Payments checkout integration
- Webhook-powered payment fulfillment
- Beautiful claymorphic UI with micro-animations

## Architecture Overview

<Frame caption="Chirpify AI Architecture">
  <img src="https://link.excalidraw.com/readonly/chirpify-architecture" alt="Architecture Diagram" />
</Frame>

```
┌─────────────────┐     ┌─────────────────┐     ┌─────────────────┐
│                 │     │                 │     │                 │
│    Frontend     │────▶│  Vercel Edge    │────▶│   ElevenLabs    │
│  (HTML/CSS/JS)  │     │   Functions     │     │    TTS API      │
│                 │     │                 │     │                 │
└────────┬────────┘     └────────┬────────┘     └─────────────────┘
         │                       │
         │                       ▼
         │              ┌─────────────────┐
         │              │  Dodo Payments  │
         └─────────────▶│  Wallets API    │◀──── Webhook
                        │  (Credit Store) │      (payment.succeeded)
                        └─────────────────┘
```

## Tech Stack

| Layer | Technology | Purpose |
|-------|------------|---------|
| Frontend | HTML5, CSS3, JavaScript (ES6+) | User interface with claymorphic design |
| Backend | Node.js 18+, Vercel Serverless Functions | API routes for TTS and payments |
| Text-to-Speech | ElevenLabs API | High-quality voice synthesis |
| Payments | Dodo Payments | One-time payments + wallet credits |
| Hosting | Vercel | Edge deployment with automatic SSL |
| State | Dodo Wallets | Server-side credit balance via wallet ledger |

## Pricing Model

| Pack | Characters | Price | Cost per 1K | Best For |
|------|------------|-------|-------------|----------|
| Starter | 10,000 | $5 | $0.50 | Trying it out |
| Pro | 50,000 | $10 | $0.20 | Regular users |
| Power | 200,000 | $25 | $0.125 | Power users |

---

## Step 1: Create Products on Dodo Payments

First, create your credit pack products in the Dodo Payments dashboard or via API.

### Option A: Using the Dashboard

<Frame caption="Creating a product in Dodo Payments Dashboard">
  <video
    src="https://your-storage.com/videos/dodo-create-product.mp4"
    controls
    autoPlay={false}
    muted
  />
</Frame>

1. Log into your [Dodo Payments Dashboard](https://dashboard.dodopayments.com)
2. Navigate to **Products** in the sidebar
3. Click **Create Product**
4. Fill in the product details:
   - **Name**: Starter Pack
   - **Description**: 10,000 characters for text-to-speech
   - **Price**: $5.00 (USD)
   - **Type**: One-time payment
   - **Tax Category**: Digital Products
5. Click **Create** and copy the `product_id`
6. Repeat for Pro and Power packs

### Option B: Using the API

```bash
# Create Starter Pack ($5 = 500 cents)
curl -X POST "https://test.dodopayments.com/products" \
  -H "Authorization: Bearer YOUR_DODO_API_KEY" \
  -H "Content-Type: application/json" \
  -d '{
    "name": "Starter Pack",
    "description": "10,000 characters for text-to-speech",
    "price": {
      "currency": "USD",
      "discount": 0,
      "price": 500,
      "purchasing_power_parity": false,
      "type": "one_time_price"
    },
    "tax_category": "digital_products"
  }'
```

<Expandable title="All three cURL commands">

```bash
# Pro Pack ($10 = 1000 cents)
curl -X POST "https://test.dodopayments.com/products" \
  -H "Authorization: Bearer YOUR_DODO_API_KEY" \
  -H "Content-Type: application/json" \
  -d '{
    "name": "Pro Pack",
    "description": "50,000 characters for text-to-speech",
    "price": {
      "currency": "USD",
      "discount": 0,
      "price": 1000,
      "purchasing_power_parity": false,
      "type": "one_time_price"
    },
    "tax_category": "digital_products"
  }'

# Power Pack ($25 = 2500 cents)
curl -X POST "https://test.dodopayments.com/products" \
  -H "Authorization: Bearer YOUR_DODO_API_KEY" \
  -H "Content-Type: application/json" \
  -d '{
    "name": "Power Pack",
    "description": "200,000 characters for text-to-speech",
    "price": {
      "currency": "USD",
      "discount": 0,
      "price": 2500,
      "purchasing_power_parity": false,
      "type": "one_time_price"
    },
    "tax_category": "digital_products"
  }'
```

</Expandable>

Save the `product_id` from each response. You'll need these for the checkout API.

<Tip>
Use `https://test.dodopayments.com` for development and `https://live.dodopayments.com` for production.
</Tip>

### Project Setup

```bash
mkdir chirpify-ai
cd chirpify-ai
npm init -y
npm install @elevenlabs/elevenlabs-js express
```

Create a `.env` file in your project root:

<CodeGroup>

```bash .env
# Dodo Payments
DODO_PAYMENTS_API_KEY=sk_test_your_test_key_here
DODO_ENV=test

# ElevenLabs
ELEVENLABS_KEY=xi_your_elevenlabs_key_here

# App URL (update for production)
SITE_URL=http://localhost:3000
```

</CodeGroup>

<Warning>
  Never commit `.env` to version control. Add it to your `.gitignore` immediately.
</Warning>

Your `package.json`:

<CodeGroup>

```json package.json
{
  "name": "chirpify-ai",
  "version": "1.0.0",
  "type": "module",
  "scripts": {
    "start": "node server.mjs"
  },
  "dependencies": {
    "@elevenlabs/elevenlabs-js": "^2.36.0",
    "express": "^5.2.1"
  }
}
```

</CodeGroup>

---

## Step 2: Build the Checkout API

Create a serverless function that creates Dodo payment sessions and returns a checkout URL.

### Payment Flow

<Frame caption="Payment Flow Diagram">
  <img src="https://link.excalidraw.com/readonly/chirpify-payment-flow" alt="Payment Flow" />
</Frame>

```
┌──────────┐    ┌──────────┐    ┌──────────┐    ┌──────────┐
│  User    │    │ Frontend │    │  API     │    │  Dodo    │
│  clicks  │───▶│  calls   │───▶│ creates  │───▶│ returns  │
│  "Buy"   │    │ /checkout│    │ payment  │    │ link     │
└──────────┘    └──────────┘    └──────────┘    └────┬─────┘
                                                     │
┌──────────┐    ┌──────────┐    ┌──────────┐         │
│ Credits  │◀───│ Frontend │◀───│  Dodo    │◀────────┘
│ updated  │    │ receives │    │ redirects│
│          │    │ callback │    │ user back│
└──────────┘    └──────────┘    └──────────┘
```

### Create a Customer (on first visit)

Before a user can buy credits or generate speech, they need a Dodo customer account. On first visit, the frontend calls this endpoint, which creates a customer and seeds their wallet with 500 free characters.

```javascript api/customer.js
import DodoPayments from 'dodopayments';

const dodo = new DodoPayments({
  environment: process.env.DODO_ENV || 'test_mode',
});

export default async function handler(req, res) {
  if (req.method !== 'POST') {
    return res.status(405).json({ error: 'Method not allowed' });
  }

  try {
    // Create a Dodo customer
    const customer = await dodo.customers.create({
      email: `user_${Date.now()}_${Math.random().toString(36).slice(2, 8)}@chirpify.ai`,
      name: 'Chirpify User',
    });

    // Credit 500 free characters as a welcome bonus
    const wallet = await dodo.customers.wallets.ledgerEntries.create(
      customer.customer_id,
      {
        amount: 500,
        currency: 'USD',
        entry_type: 'credit',
        idempotency_key: `welcome_${customer.customer_id}`,
        reason: 'Welcome bonus: 500 free characters',
      }
    );

    res.json({ customerId: customer.customer_id, balance: wallet.balance });
  } catch (err) {
    console.error('Customer creation error:', err.message);
    res.status(500).json({ error: 'Failed to create customer' });
  }
}
```

The `customer_id` gets stored in the browser's `localStorage`. Every subsequent API call includes it so the server knows whose wallet to check.

### Checkout Implementation

```javascript api/checkout.js
import DodoPayments from 'dodopayments';

const PRODUCTS = {
  starter: { id: 'pdt_YOUR_STARTER_ID', characters: 10000, price: 5, name: 'Starter Pack' },
  pro:     { id: 'pdt_YOUR_PRO_ID',     characters: 50000, price: 10, name: 'Pro Pack' },
  power:   { id: 'pdt_YOUR_POWER_ID',   characters: 200000, price: 25, name: 'Power Pack' },
};

const dodo = new DodoPayments({
  environment: process.env.DODO_ENV || 'test_mode',
});

export default async function handler(req, res) {
  if (req.method !== 'POST') {
    return res.status(405).json({ error: 'Method not allowed' });
  }

  const { pack, customerId } = req.body;

  if (!pack || !PRODUCTS[pack]) {
    return res.status(400).json({ error: 'Invalid pack selected' });
  }
  if (!customerId) {
    return res.status(400).json({ error: 'customerId is required' });
  }

  const product = PRODUCTS[pack];
  const returnUrl = process.env.SITE_URL || 'https://chirpify-ai.vercel.app';

  try {
    const payment = await dodo.payments.create({
      payment_link: true,
      billing: { country: 'US' },
      customer: { customer_id: customerId },
      product_cart: [{ product_id: product.id, quantity: 1 }],
      return_url: `${returnUrl}?success=true`,
    });

    res.json({
      checkoutUrl: payment.payment_link,
      characters: product.characters,
      productName: product.name,
    });
  } catch (err) {
    console.error('Checkout error:', err.message);
    res.status(500).json({ error: 'Failed to create checkout session' });
  }
}
```

<Note>
Replace `pdt_YOUR_STARTER_ID`, `pdt_YOUR_PRO_ID`, and `pdt_YOUR_POWER_ID` with the product IDs from Step 1.
</Note>

Two key differences from a basic integration:
1. **`customer: { customer_id: customerId }`** -Links the payment to an existing Dodo customer instead of a hardcoded placeholder. This is what connects the payment to the right wallet.
2. **No `characters` in the return URL** -Credits are added server-side via webhook, not client-side via URL params.

<Warning>
**Critical:** Always include `payment_link: true` in your request body. Without it, `payment_link` will be `null` in the response and users won't be able to checkout.
</Warning>

---

## Step 3: Handle Payment Success with Webhooks

When a payment succeeds, Dodo fires a `payment.succeeded` webhook. Your webhook handler maps the purchased product to a character count and credits the customer's wallet. No URL params, no localStorage -the server is the source of truth.

```javascript api/webhook.js
import DodoPayments from 'dodopayments';

const dodo = new DodoPayments({
  environment: process.env.DODO_ENV || 'test_mode',
});

// Map product IDs to character credits
const PRODUCT_CREDITS = {
  'pdt_YOUR_STARTER_ID': 10000,   // Starter Pack
  'pdt_YOUR_PRO_ID':     50000,   // Pro Pack
  'pdt_YOUR_POWER_ID':   200000,  // Power Pack
};

export default async function handler(req, res) {
  if (req.method !== 'POST') {
    return res.status(405).json({ error: 'Method not allowed' });
  }

  // Validate webhook signature headers
  const webhookId = req.headers['webhook-id'];
  const webhookTimestamp = req.headers['webhook-timestamp'];
  const webhookSignature = req.headers['webhook-signature'];

  if (!webhookId || !webhookTimestamp || !webhookSignature) {
    return res.status(400).json({ error: 'Missing webhook signature headers' });
  }

  const event = req.body;
  const eventType = req.headers['webhook-event-type'];

  // Only handle successful payments
  if (eventType !== 'payment.succeeded') {
    return res.json({ received: true });
  }

  const customerId = event.customer?.customer_id;
  const paymentId = event.payment_id;
  const productId = (event.product_cart || [])[0]?.product_id;

  if (!customerId || !productId) {
    return res.status(400).json({ error: 'Missing customer or product info' });
  }

  const characters = PRODUCT_CREDITS[productId];
  if (!characters) {
    return res.status(400).json({ error: 'Unknown product' });
  }

  try {
    // Credit the customer's wallet
    const wallet = await dodo.customers.wallets.ledgerEntries.create(
      customerId,
      {
        amount: characters,
        currency: 'USD',
        entry_type: 'credit',
        idempotency_key: paymentId, // Prevents double-credit on retry
        reason: `Credit pack purchase: ${characters.toLocaleString()} characters`,
      }
    );

    console.log(`Credited ${characters} chars to ${customerId}. New balance: ${wallet.balance}`);
    res.json({ received: true, credited: characters, balance: wallet.balance });
  } catch (err) {
    console.error('Webhook processing error:', err.message);
    res.status(500).json({ error: 'Webhook processing failed' });
  }
}
```

The `idempotency_key` is critical -Dodo retries failed webhooks, and this key ensures the wallet is only credited once per payment.

<Tip>
Register your webhook URL in the [Dodo Dashboard](https://dashboard.dodopayments.com) under **Webhooks**. Filter for `payment.succeeded` events only.
</Tip>

---

## Step 4: Track Usage and Deduct Credits (Server-Side)

Every TTS request now goes through the server, which checks the wallet balance before calling ElevenLabs and debits only after a successful generation. Users can't manipulate their balance -Dodo's wallet is the single source of truth.

```javascript api/speak.js
import { ElevenLabsClient } from "@elevenlabs/elevenlabs-js";
import DodoPayments from 'dodopayments';

const VOICES = {
  george: { id: "JBFqnCBsd6RMkjVDRZzb", name: "George", desc: "Warm British" },
  aria:   { id: "9BWtsMINqrJLrRacOk9x", name: "Aria", desc: "Expressive American" },
  roger:  { id: "CwhRBWXzGAHq8TQ4Fs17", name: "Roger", desc: "Confident American" },
  sarah:  { id: "EXAVITQu4vr4xnSDxMaL", name: "Sarah", desc: "Soft American" },
  charlie:{ id: "IKne3meq5aSn9XLyUdCD", name: "Charlie", desc: "Casual Australian" },
};

const client = new ElevenLabsClient({ apiKey: process.env.ELEVENLABS_KEY });

const dodo = new DodoPayments({
  environment: process.env.DODO_ENV || 'test_mode',
});

export default async function handler(req, res) {
  if (req.method !== "POST") {
    return res.status(405).json({ error: "Method not allowed" });
  }

  const { text, voice, customerId } = req.body;

  if (!text || text.trim().length === 0) {
    return res.status(400).json({ error: "No text provided" });
  }
  if (text.length > 500) {
    return res.status(400).json({ error: "Text too long. Max 500 characters." });
  }
  if (!customerId) {
    return res.status(400).json({ error: "customerId is required" });
  }

  const voiceId = VOICES[voice]?.id || VOICES.george.id;
  const charCost = text.length;

  try {
    // 1. Check wallet balance
    const walletData = await dodo.customers.wallets.list(customerId);
    const wallet = walletData.items?.find(w => w.currency === 'USD');
    const balance = wallet?.balance || 0;

    if (balance < charCost) {
      return res.status(402).json({
        error: `Insufficient credits. Need ${charCost}, have ${balance}.`,
        balance,
      });
    }

    // 2. Generate speech via ElevenLabs
    const audio = await client.textToSpeech.convert(voiceId, {
      text, model_id: "eleven_multilingual_v2"
    });

    const chunks = [];
    for await (const chunk of audio) {
      chunks.push(chunk);
    }
    const buffer = Buffer.concat(chunks);

    // 3. Debit wallet ONLY after successful generation
    const debitResult = await dodo.customers.wallets.ledgerEntries.create(
      customerId,
      {
        amount: charCost,
        currency: 'USD',
        entry_type: 'debit',
        idempotency_key: `tts_${customerId}_${Date.now()}`,
        reason: `TTS generation: ${charCost} characters`,
      }
    );

    res.json({
      audio: buffer.toString("base64"),
      characters: charCost,
      voice: VOICES[voice]?.name || "George",
      balance: debitResult.balance,
    });
  } catch (err) {
    console.error("Speak error:", err.message);
    res.status(500).json({ error: "Speech generation failed. Try again." });
  }
}
```

The pattern: **check → generate → debit**. Never charge for a failed generation. The `402` status code tells the frontend to show the pricing modal.

---

## Step 5: Build the Pricing UI

Create an attractive modal that displays when users need more credits.

<Frame caption="Pricing modal design">
  <img src="/images/chirpify-pricing-modal.png" alt="Pricing Modal" />
</Frame>

### HTML Structure

```html
<div class="pricing-overlay" id="pricingOverlay">
  <div class="pricing-modal">
    <div class="pricing-header">
      <h2>Buy Credits</h2>
      <p>Get more characters to keep generating speech!</p>
    </div>

    <div class="pricing-grid">
      <div class="pricing-card" data-pack="starter">
        <div class="amount">10K</div>
        <div class="label">characters</div>
        <div class="price">$5</div>
      </div>

      <div class="pricing-card popular" data-pack="pro">
        <div class="amount">50K</div>
        <div class="label">characters</div>
        <div class="price">$10</div>
        <div class="tag">Most Popular</div>
      </div>

      <div class="pricing-card" data-pack="power">
        <div class="amount">200K</div>
        <div class="label">characters</div>
        <div class="price">$25</div>
        <div class="tag">Best Value</div>
      </div>
    </div>

    <button class="pricing-close" id="pricingClose">Maybe Later</button>
  </div>
</div>
```

### JavaScript Handler

```javascript
// Handle pricing card clicks
document.querySelectorAll('.pricing-card').forEach(card => {
  card.addEventListener('click', async () => {
    const pack = card.dataset.pack;
    const customerId = localStorage.getItem('chirpify_customer_id');

    // Show loading state
    card.style.opacity = '0.7';
    card.style.pointerEvents = 'none';

    try {
      const res = await fetch('/api/checkout', {
        method: 'POST',
        headers: { 'Content-Type': 'application/json' },
        body: JSON.stringify({ pack, customerId }),
      });

      const data = await res.json();

      if (!res.ok) {
        throw new Error(data.error || 'Checkout failed');
      }

      // Redirect to Dodo Payments checkout
      window.location.href = data.checkoutUrl;

    } catch (err) {
      showError(err.message);
      card.style.opacity = '1';
      card.style.pointerEvents = 'auto';
    }
  });
});
```

---

## Step 6: Display Credit Balance

A live counter in the header that shows the balance from Dodo's wallet. Green when healthy, yellow when running low, red when empty.

```javascript
// Fetch balance from Dodo wallet via your API
async function fetchBalance() {
  const res = await fetch(`/api/balance?customer_id=${customerId}`);
  const data = await res.json();
  credits = data.balance;
  updateCreditsDisplay();
}

function updateCreditsDisplay() {
  const display = document.querySelector('.credits-number');
  const container = document.getElementById('creditsCount');

  display.textContent = credits >= 1000
    ? (credits / 1000).toFixed(credits % 1000 === 0 ? 0 : 1) + 'K'
    : credits.toString();

  container.classList.remove('low', 'empty');
  if (credits <= 0) container.classList.add('empty');
  else if (credits < 100) container.classList.add('low');
}
```

The balance comes from `/api/balance`, which reads the Dodo wallet. After each TTS generation, the `/api/speak` response includes the updated balance so the UI stays in sync without an extra API call.

---

## Step 7: Balance API

Create an endpoint that returns the customer's current wallet balance. The frontend calls this on page load and after returning from checkout.

```javascript api/balance.js
import DodoPayments from 'dodopayments';

const dodo = new DodoPayments({
  environment: process.env.DODO_ENV || 'test_mode',
});

export default async function handler(req, res) {
  if (req.method !== 'GET') {
    return res.status(405).json({ error: 'Method not allowed' });
  }

  const customerId = req.query.customer_id;
  if (!customerId) {
    return res.status(400).json({ error: 'customer_id is required' });
  }

  try {
    const walletData = await dodo.customers.wallets.list(customerId);
    const wallet = walletData.items?.find(w => w.currency === 'USD');

    res.json({
      balance: wallet?.balance || 0,
      customerId,
    });
  } catch (err) {
    console.error('Balance check error:', err.message);
    res.status(500).json({ error: 'Failed to fetch balance' });
  }
}
```

---

## Deployment

### Environment Variables

Set these in your Vercel dashboard under **Settings > Environment Variables**:

<Frame caption="Setting environment variables in Vercel">
  <video
    src="https://your-storage.com/videos/vercel-env-vars.mp4"
    controls
    autoPlay={false}
    muted
  />
</Frame>

| Variable | Description | Example |
|----------|-------------|---------|
| `DODO_PAYMENTS_API_KEY` | Your Dodo API key | `sk_live_...` or `sk_test_...` |
| `DODO_ENV` | Environment (`test_mode` or `live_mode`) | `test_mode` |
| `ELEVENLABS_KEY` | Your ElevenLabs API key | `xi_...` |
| `SITE_URL` | Your production URL | `https://chirpify-ai.vercel.app` |

### Vercel Configuration

```json vercel.json
{
  "framework": null,
  "buildCommand": "",
  "installCommand": "npm install",
  "outputDirectory": "public"
}
```

### Deploy Command

```bash
# Install Vercel CLI
npm install -g vercel

# Deploy to production
vercel --prod
```

---

## Testing

### Test Card Details

Use Dodo's test card to simulate payments in the test environment:

| Field | Value |
|-------|-------|
| Card Number | `4242 4242 4242 4242` |
| Expiry | Any future date (e.g., `12/34`) |
| CVC | Any 3 digits (e.g., `123`) |
| ZIP | Any 5 digits (e.g., `12345`) |

### Full Test Flow

Walk through this end-to-end. If every step checks out, your integration is complete.

<Steps>
  <Step title="Use your free characters">
    Load the app, type a short sentence, pick a voice, and hit generate.

    **Expected:**
    ```
    ✓ Audio plays back in the browser
    ✓ Credit counter drops from 500 → ~470 (depending on text length)
    ✓ No payment required
    ```
  </Step>

  <Step title="Trigger the upsell">
    Enter text longer than your remaining balance (or just keep generating until you run out).

    **Expected:**
    ```
    ✓ Pricing modal appears with three packs
    ✓ No ElevenLabs API call is made
    ✓ Credit counter shows 0 (red)
    ```
  </Step>

  <Step title="Complete a test purchase">
    Click the Pro Pack ($10 / 50K characters). You'll be redirected to Dodo's checkout page.

    Enter the test card:
    - Card: `4242 4242 4242 4242`
    - Expiry: any future date
    - CVC: any 3 digits

    **Expected:**
    ```
    ✓ Redirected to Dodo checkout page
    ✓ Test card accepted
    ✓ Redirected back to your app with ?success=true
    ✓ Webhook fires → wallet credited with 50,000 characters
    ✓ Credit counter updates on next balance fetch
    ```
  </Step>

  <Step title="Verify in Dodo dashboard">
    Open [test.dodopayments.com](https://test.dodopayments.com).

    **Expected:**
    ```
    ✓ Payments → Payment shows status: Succeeded, Amount: $10.00
    ✓ Customers → Click your customer → Wallet tab shows:
      - Welcome bonus: +500 characters (credit)
      - TTS generations: -N characters each (debit)
      - Credit pack purchase: +50,000 characters (credit)
    ```

    <Check>
      If the payment shows in the dashboard and the wallet ledger has the correct entries, the integration is working end-to-end.
    </Check>
  </Step>

  <Step title="Generate more speech">
    Go back to the app, generate a few more clips.

    **Expected:**
    ```
    ✓ Audio plays normally
    ✓ Credits deduct correctly per character (server-side)
    ✓ Balance persists after page refresh (fetched from Dodo wallet)
    ```
  </Step>
</Steps>

---

## Complete Source Code

<CardGroup cols={2}>
  <Card title="GitHub Repository" icon="github" href="https://github.com/aainanarang29/chirpify-ai">
    View the complete source code for Chirpify AI
  </Card>
  <Card title="Live Demo" icon="play" href="https://chirpify-ai.vercel.app">
    Try the live demo with 500 free characters
  </Card>
</CardGroup>

---

## Key Takeaways

<CardGroup cols={2}>
  <Card title="payment_link: true" icon="link">
    Always include this parameter to get a checkout URL from Dodo Payments. The most common integration mistake.
  </Card>
  <Card title="Dodo Wallets = Server-Side Credits" icon="database">
    Wallet ledger entries give you tamper-proof, auditable credit tracking. No database needed -Dodo is your source of truth.
  </Card>
  <Card title="Webhooks + Idempotency Keys" icon="arrow-right">
    Always use the `payment_id` as your `idempotency_key` when crediting wallets. Dodo retries failed webhooks, and this prevents double-credits.
  </Card>
  <Card title="Check → Generate → Debit" icon="shield">
    Always check wallet balance before calling ElevenLabs. Only debit after a successful generation. Return 402 to trigger the upsell modal.
  </Card>
</CardGroup>

---

## Test vs Live Environment

<Warning>
**Important:** This cookbook uses **test environment** keys and URLs for demonstration purposes. Before going to production, you must switch to live credentials.
</Warning>

### Environment Differences

| Aspect | Test Environment | Live Environment |
|--------|------------------|------------------|
| Base URL | `https://test.dodopayments.com` | `https://live.dodopayments.com` |
| API Keys | Start with `sk_test_` | Start with `sk_live_` |
| Payments | Simulated (no real charges) | Real money transactions |
| Test Cards | `4242 4242 4242 4242` works | Real credit cards only |
| Dashboard | [test.dodopayments.com](https://test.dodopayments.com) | [dashboard.dodopayments.com](https://dashboard.dodopayments.com) |

### Switching to Production

1. **Create live products** in the [Dodo Payments Dashboard](https://dashboard.dodopayments.com)
2. **Generate a live API key** from the dashboard
3. **Update environment variables** in Vercel:
   ```bash
   DODO_PAYMENTS_API_KEY=sk_live_your_live_key
   DODO_ENV=live
   ```
4. **Update product IDs** in `api/checkout.js` with your live product IDs
5. **Test with a real card** (you can refund test purchases)

<Tip>
**Recommended Setup:**
- **Development/Staging:** Use `test` environment with test API keys
- **Production:** Use `live` environment with live API keys

Set `DODO_ENV=test_mode` in your staging deployment and `DODO_ENV=live_mode` in production. The SDK automatically switches the base URL based on this variable.
</Tip>

---

## Need Help?

<CardGroup cols={3}>
  <Card title="Dodo Payments Docs" icon="book" href="https://docs.dodopayments.com">
    Official API documentation
  </Card>
  <Card title="ElevenLabs Docs" icon="microphone" href="https://docs.elevenlabs.io">
    Text-to-speech API reference
  </Card>
  <Card title="Vercel Docs" icon="triangle" href="https://vercel.com/docs">
    Deployment and serverless functions
  </Card>
</CardGroup>
